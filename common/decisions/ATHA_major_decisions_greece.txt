##############################
# Form k_lakedaimon		 	 #
##############################

# TO-DO: Move effects to a notification event, which would also give the Spartan king the choice of whether to enslave the Messenians or maintain their freedom (and this in turn triggers a notification event for neighbouring rulers, or perhaps all rulers with land in k_hellas?)

## Enslave the Messenians:
## - spend piety
## - lose opinion with same-faith (?) independent rulers
## - provinces in d_messenia gain a permanent modifier that boosts control and taxes but hurts popular opinion & slows development growth
## - provinces in d_sparta (or just c_sparta?) gain a temporary modifier that boosts development and reduces construction time and cost
## - character modifier and nickname?
## - opens up decision for foreign rulers to liberate the Messenians (and humiliate the Spartans) - the ruler could then have some choices as to how free Messenia should be (in name only, autonomous subject, independent ally etc.) Perhaps Spartan rulers could have their own decision to free their Messenian subjects, which would hurt control and remove the modifiers

## Offer the Messenians perioikoi status
## - provinces in d_messenia gain a temporary modifier that boosts levy_size
## - gain piety


form_k_lakedaimon_decision = { # aka: Restore the Spartan Hegemony
	picture = "gfx/interface/illustrations/decisions/decision_dynasty_house.dds"
	major = yes

	ai_check_interval = 120

	desc = form_k_lakedaimon_decision_desc
	selection_tooltip = form_k_lakedaimon_decision_tooltip

	is_shown = {
		has_culture = culture:dorian_south
		has_government = city_state_spartan_government
		highest_held_title_tier <= tier_duchy
		NOT = {	
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_formed_k_lakedaimon
			}
		}
	}

	is_valid = {
		is_independent_ruler = yes
		has_primary_title = title:d_lakedaimon
		#completely_controls = title:d_messenia
		#completely_controls = title:c_megalopolis # part of Megalopolis' purpose was to keep Sparta at bay
		#completely_controls = title:c_thyreatis # given to the Argives by Philip II 
	}

	is_valid_showing_failures_only = {
		
	}

	effect = {
		save_scope_as = k_lakedaimon_founder

		show_as_tooltip = { form_k_lakedaimon_decision_effects = yes } # Actually applied in greece.0001 - prestige, de-jure, title etc

		#Events
		trigger_event = greece_decisions.0001

		# Once per game
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:flag_formed_k_lakedaimon
		}
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

##############################
# Form k_bithynia		 	 #
##############################

# TO-DO: Move effects to a notification event, which would also let the player refound either Astakos or Chalkedon as the kingdom's capital. Additional effects:
# - The new capital gains a modifier similar to those from the "Found the Capital of the Rus'" event; we may want to include a development growth modifier rather than having it immediately increase by an arbitrary amount
# - +100 control in Realm Capital
# - New capital becomes de jure capital of k_bithynia
# - If clan, adopts feudal government
# - Tribal vassals adopt clan government
# - (Possibly exceassive) Bithynian culture gains the Monetary Standards and Bureaucracy innovations
# - (Probably excessive) Character gains philhellene modifier, boosting their relationship with Greek characters as long as their culture is non-Greek (is this even possible?) - in the future it may be worth looking into whether a similar modifier could be applied to dynasties that became considerably Hellenised, though this should be invalidated for characters who adopt Greek culture. The ideal ultimately would be to have this work dynamically with any culture to reflect peer polity interaction

form_k_bithynia_decision = { # aka: Consolidate the Kingdom of Bithynia
	picture = "gfx/interface/illustrations/decisions/decision_dynasty_house.dds"
	major = yes

	ai_check_interval = 120

	desc = form_k_bithynia_decision_desc
	selection_tooltip = form_k_bithynia_decision_tooltip

	is_shown = {
		has_culture = culture:bithynian
		highest_held_title_tier <= tier_duchy
		OR = {
			has_government = feudal_government
			has_government = clan_government
		}
		NOT = {	
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:flag_formed_k_bithynia
			}
		}
	}

	is_valid = {
		# Must be independent
		is_independent_ruler = yes
		# Should have a decent prestige level
		prestige_level >= high_prestige_level
		# Must control d_bithynia, and at least one of the other component duchies
		has_primary_title = title:d_bithynia
		OR = {
			has_title = title:d_mariandynia
			has_title = title:d_askania
			has_title = title:d_sangarios
		}
		# Must personally hold a city in d_bithynia that can serve as the new capital
		OR = {
			has_title = title:c_astakos
			has_title = title:c_chalkedon
		}
		# Should also have asserted dominance over at least one of the other main cities in the broader region
		OR = {
			completely_controls = title:c_nikaia
			completely_controls = title:c_herakleia_pontica
		}

	}

	is_valid_showing_failures_only = {
		
	}

	effect = {
		# De jure shifts.
		title:d_bithynia = { set_de_jure_liege_title = title:k_bithynia }
		title:d_mariandynia = { set_de_jure_liege_title = title:k_bithynia }
		title:d_askania = { set_de_jure_liege_title = title:k_bithynia }
		title:d_sangarios = { set_de_jure_liege_title = title:k_bithynia }
		#hidden_effect = {
		#	title:k_bithynia = { set_de_jure_liege_title = title:e_anatolia }
		#}

		# Create kingdom title.
		create_title_and_vassal_change = {
			type = created
			save_scope_as = change
			add_claim_on_loss = no
		}
		title:k_bithynia = {
			change_title_holder = {
				holder = root
				change = scope:change
			}
		}
		resolve_title_and_vassal_change = scope:change

		add_prestige = major_prestige_gain

		#Once per game
		add_to_global_variable_list = {
			name = unavailable_unique_decisions
			target = flag:flag_formed_k_bithynia
		}
	}

	cost = {
		gold = 500
		prestige = 1000
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}